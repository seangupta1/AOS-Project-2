<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Logs</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header class="dashboard_header">
        <div>
            <a href="{{ url_for('dashboard') }}" class="button-dashboard" style="position: absolute; left: 5px; top: 5px;">â¬… Back to Dashboard</a>
        </div>
        <div>
            <h1>Application Logs</h1>
        </div>
    </header>

    <div class="user-files-container">
        <div style="padding: 20px;">
            <table class="table-user-files" id="log-table">
                <thead>
                    <tr>
                        <th style="width: 25%;">Timestamp</th>
                        <th style="width: 10%;">Level</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody id="log-body">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        function fetchAndDisplayLogs() {
            fetch("{{ url_for('api_logs') }}")
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error(data.error);
                        return;
                    }

                    const logBody = document.getElementById('log-body');
                    logBody.innerHTML = ''; // Clear old logs

                    if (data.logs.length === 0) {
                        logBody.innerHTML = '<tr><td colspan="3" style="text-align:center;">No logs found.</td></tr>';
                        return;
                    }

                    data.logs.forEach(log => {
                        const row = document.createElement('tr');

                        if (log.level === 'WARNING') {
                            row.classList.add('log-warning');
                        } else if (log.level === 'ERROR') {
                            row.classList.add('log-error');
                        }
                        
                        // Add cells for timestamp, level, and message
                        row.innerHTML = `
                            <td>${log.timestamp || 'N/A'}</td>
                            <td>${log.level || 'N/A'}</td>
                            <td>${log.message || 'N/A'}</td>
                        `;
                        logBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Error fetching logs:', error));
        }

        // Fetch logs on page load
        fetchAndDisplayLogs();

        // Refresh logs every 10 seconds
        setInterval(fetchAndDisplayLogs, 10000);
    </script>
</body>
</html>